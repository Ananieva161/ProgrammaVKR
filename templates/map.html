<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ö–∞—Ä—Ç–∞ –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–π</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.8.0/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.8.0/dist/leaflet.js"></script>

    <!-- Leaflet Routing Machine -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine/dist/leaflet-routing-machine.css" />
    <script src="https://unpkg.com/leaflet-routing-machine/dist/leaflet-routing-machine.min.js"></script>

    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f0f5f3;
            color: #2c5b4b;
        }

        header {
            background-color: #6dbd9e;
            color: white;
            padding: 20px;
            text-align: center;
        }

        nav ul {
            list-style-type: none;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
        }

        nav li {
            margin: 0 10px;
        }

        nav a {
            color: white;
            text-decoration: none;
        }

        main {
            padding: 20px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }

        th, td {
            padding: 8px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        tr:hover {
            background-color: #e5f2ed;
        }

        button {
            background-color: #6dbd9e;
            color: white;
            padding: 10px 20px;
            border: none;
            cursor: pointer;
            margin-right: 10px;
        }

        button:hover {
            background-color: #54a685;
        }

        .container {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .table-container {
            width: 80%;
            margin-bottom: 20px;
        }

        .form-container {
            display: none;
            margin-bottom: 20px;
            text-align: center;
        }

        .dropdown-container {
            margin-bottom: 20px;
        }
        .btn-add {
            margin-top: 20px;
        }
        h1 { margin: 10px 0; }
        #map {
            width: 100%;
            height: 60vh;
            max-width: 1200px;
            margin: auto;
            border-radius: 8px;
        }
        table {
            width: 95%;
            max-width: 1200px;
            margin: 15px auto;
            border-collapse: collapse;
            background: white;
            border-radius: 8px;
        }
        th, td {
            padding: 10px;
            border: 1px solid #ddd;
        }
        th {
            background-color: #007bff;
            color: white;
        }
        button {
            margin: 5px;
            padding: 8px 12px;
            border-radius: 5px;
            border: none;
            cursor: pointer;
        }
        .btn-red { background-color: #dc3545; color: white; }
        .btn-yellow { background-color: #ffc107; }
        .btn-clear { background-color: #6c757d; color: white; }
    </style>
</head>
<header>
    <nav>
        <ul>
            <li><a href="/">–ì–ª–∞–≤–Ω–∞—è</a></li>
        </ul>
    </nav>
</header>
<body>
<h1>–ö–∞—Ä—Ç–∞ –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–π</h1>

<div>
    <button class="btn-red" onclick="drawRoutes('–ü–æ—Å—Ç–∞–≤—â–∏–∫')">üî¥ –ú–∞—Ä—à—Ä—É—Ç—ã: –ü–æ—Å—Ç–∞–≤—â–∏–∫–∏</button>
    <button class="btn-yellow" onclick="drawRoutes('–ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å')">üü° –ú–∞—Ä—à—Ä—É—Ç—ã: –ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏</button>
    <button class="btn-clear" onclick="clearRoutes()">‚ùå –û—á–∏—Å—Ç–∏—Ç—å –º–∞—Ä—à—Ä—É—Ç—ã</button>
</div>

<div id="map"></div>

<table>
    <thead>
        <tr>
            <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
            <th>–¢–∏–ø</th>
            <th>–ù–∞—Å–µ–ª—ë–Ω–Ω—ã–π –ø—É–Ω–∫—Ç</th>
            <th>–°—Ç–æ–∏–º–æ—Å—Ç—å</th>
            <th>–î–µ–π—Å—Ç–≤–∏–µ</th>
        </tr>
    </thead>
    <tbody id="route-tbody"></tbody>
</table>

<script>
    var map = L.map('map').setView([60, 40], 6);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    // Leaflet Routing Machine
    var routingControl;

    // –ü–æ–ª—É—á–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ Python
    var enterprises = {{ enterprises | tojson }};
    var timber_enterprises = {{ timber_enterprises | tojson }};
    var consumers = {{ consumers | tojson }};

    var supplierIcon = L.divIcon({ html: '<div style="width: 20px; height: 20px; background-color: green;"></div>' });
    var consumerIcon = L.divIcon({ html: '<div style="width: 20px; height: 20px; background-color: blue; border-radius: 50%;"></div>' });

    var allEnterpriseMarkers = [];
    var allSupplierMarkers = [];
    var allConsumerMarkers = [];
    var activeRoutes = [];

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –≥–æ—Ä–æ–¥–∞ —á–µ—Ä–µ–∑ Nominatim
    function fetchLocationName(lat, lon, callback) {
        const url = `https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}`;
        fetch(url)
            .then(res => res.json())
            .then(data => {
                let city = data.address?.city || data.address?.town || data.address?.village || "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ";
                callback(city);
            })
            .catch(() => callback("–û—à–∏–±–∫–∞"));
    }

    function createMarker(entity, type) {
        if (!entity[2]) return;
        let lon = entity[2][0], lat = entity[2][1];
        let marker;

        if (type === "–ü–æ—Å—Ç–∞–≤—â–∏–∫") {
            marker = L.marker([lat, lon], { icon: supplierIcon }).addTo(map);
            allSupplierMarkers.push(marker);
        } else if (type === "–ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å") {
            marker = L.marker([lat, lon], { icon: consumerIcon }).addTo(map);
            allConsumerMarkers.push(marker);
        } else {
            marker = L.marker([lat, lon], { draggable: true }).addTo(map);
            allEnterpriseMarkers.push(marker);
            marker.on('dragend', function(e) {
                var latlng = e.target.getLatLng();
                updateMarkerLocation(entity[0], latlng.lat, latlng.lng);
                fetchLocationName(latlng.lat, latlng.lng, function(city) {
                    updateCityName(entity[0], city);
                });
            });
        }

        // –ü–æ–ª—É—á–∞–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ –≥–æ—Ä–æ–¥–∞ —á–µ—Ä–µ–∑ Nominatim
        fetchLocationName(lat, lon, function(city) {
            marker.bindPopup('<b>' + entity[1] + '</b><br>' + city);
            addRow(entity[0], entity[1], type, city, marker.getLatLng(), entity[3]);
        });

        return marker;
    }

    function updateMarkerLocation(id, lat, lon) {
        fetch('/update_location', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ id, type: 'enterprise', lat, lon })
        }).catch(err => console.error(err));
    }

    function updateCityName(id, city) {
        let cityElem = document.getElementById('loc-' + id);
        if (cityElem) cityElem.innerText = city;
    }

    function addRow(id, name, type, city, latlng, cost) {
        let tr = document.createElement('tr');
        tr.innerHTML =
            `<td>${name}</td>
            <td>${type}</td>
            <td id="loc-${id}">${city}</td>
            <td>${cost || '-'}</td>
            <td>${type === "–ü—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–µ" ? `<button onclick="saveNewLocation(${id}, ${latlng.lat}, ${latlng.lng})">–í—ã–±—Ä–∞—Ç—å</button>` : ''}</td>`;
        document.getElementById('route-tbody').appendChild(tr);
    }

    function saveNewLocation(id, lat, lon) {
        updateMarkerLocation(id, lat, lon);
    }

    function drawRoutes(type) {
        clearRoutes(); // –û—á–∏—Å—Ç–∏—Ç—å —Å—Ç–∞—Ä—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã

        let markers;
        let routeColor;
        if (type === '–ü–æ—Å—Ç–∞–≤—â–∏–∫') {
            markers = allSupplierMarkers;
            routeColor = 'red'; // –ö—Ä–∞—Å–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã –¥–ª—è –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤
        } else {
            markers = allConsumerMarkers;
            routeColor = 'yellow'; // –ñ–µ–ª—Ç—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã –¥–ª—è –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–µ–π
        }

        markers.forEach(marker => {
            const sourceLatLng = marker.getLatLng();

            // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –≤—Å–µ –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏—è –∏–ª–∏ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–µ–π –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞
            let otherMarkers = (type === '–ü–æ—Å—Ç–∞–≤—â–∏–∫') ? allEnterpriseMarkers : allSupplierMarkers;
            otherMarkers.forEach(otherMarker => {
                const destinationLatLng = otherMarker.getLatLng();

                if (!sourceLatLng || !destinationLatLng) return; // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç

                routingControl = L.Routing.control({
                    waypoints: [sourceLatLng, destinationLatLng],
                    lineOptions: { styles: [{ color: routeColor, weight: 4 }] },
                    router: L.Routing.osrmv1({ serviceUrl: 'https://router.project-osrm.org/route/v1' }),
                    createMarker: () => null,
                    addWaypoints: false,
                    draggableWaypoints: false
                }).addTo(map);
                activeRoutes.push(routingControl);
            });
        });
    }

    function clearRoutes() {
        activeRoutes.forEach(route => map.removeControl(route));
        activeRoutes = [];
    }

    // –°–æ–∑–¥–∞–µ–º –º–∞—Ä–∫–µ—Ä—ã –¥–ª—è –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö
    enterprises.forEach(e => createMarker(e, "–ü—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–µ"));
    timber_enterprises.forEach(t => createMarker(t, "–ü–æ—Å—Ç–∞–≤—â–∏–∫"));
    consumers.forEach(c => createMarker(c, "–ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å"));
</script>
</body>
</html>

<!--<!DOCTYPE html>-->
<!--<html lang="ru">-->
<!--<head>-->
<!--    <meta charset="UTF-8">-->
<!--    <title>–ö–∞—Ä—Ç–∞ –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–π</title>-->
<!--    <meta name="viewport" content="width=device-width, initial-scale=1.0">-->

<!--    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.8.0/dist/leaflet.css" />-->
<!--    <script src="https://unpkg.com/leaflet@1.8.0/dist/leaflet.js"></script>-->

<!--    &lt;!&ndash; Leaflet Routing Machine &ndash;&gt;-->
<!--    <link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine/dist/leaflet-routing-machine.css" />-->
<!--    <script src="https://unpkg.com/leaflet-routing-machine/dist/leaflet-routing-machine.min.js"></script>-->

<!--    <style>-->
<!--        body {-->
<!--            font-family: Arial, sans-serif;-->
<!--            background-color: #f4f4f4;-->
<!--            text-align: center;-->
<!--            margin: 0;-->
<!--            padding: 0;-->
<!--        }-->
<!--        h1 { margin: 10px 0; }-->
<!--        #map {-->
<!--            width: 100%;-->
<!--            height: 60vh;-->
<!--            max-width: 1200px;-->
<!--            margin: auto;-->
<!--            border-radius: 8px;-->
<!--        }-->
<!--        table {-->
<!--            width: 95%;-->
<!--            max-width: 1200px;-->
<!--            margin: 15px auto;-->
<!--            border-collapse: collapse;-->
<!--            background: white;-->
<!--            border-radius: 8px;-->
<!--        }-->
<!--        th, td {-->
<!--            padding: 10px;-->
<!--            border: 1px solid #ddd;-->
<!--        }-->
<!--        th {-->
<!--            background-color: #007bff;-->
<!--            color: white;-->
<!--        }-->
<!--        button {-->
<!--            margin: 5px;-->
<!--            padding: 8px 12px;-->
<!--            border-radius: 5px;-->
<!--            border: none;-->
<!--            cursor: pointer;-->
<!--        }-->
<!--        .btn-red { background-color: #dc3545; color: white; }-->
<!--        .btn-yellow { background-color: #ffc107; }-->
<!--        .btn-clear { background-color: #6c757d; color: white; }-->
<!--    </style>-->
<!--</head>-->
<!--<body>-->
<!--<h1>–ö–∞—Ä—Ç–∞ –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–π</h1>-->

<!--<div>-->
<!--    <button class="btn-red" onclick="drawSupplierRoutes()">üî¥ –ú–∞—Ä—à—Ä—É—Ç—ã: –ü–æ—Å—Ç–∞–≤—â–∏–∫–∏</button>-->
<!--    <button class="btn-yellow" onclick="drawConsumerRoutes()">üü° –ú–∞—Ä—à—Ä—É—Ç—ã: –ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏</button>-->
<!--    <button class="btn-clear" onclick="clearRoutes()">‚ùå –û—á–∏—Å—Ç–∏—Ç—å –º–∞—Ä—à—Ä—É—Ç—ã</button>-->
<!--</div>-->

<!--<div id="map"></div>-->

<!--<table>-->
<!--    <thead>-->
<!--        <tr>-->
<!--            <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>-->
<!--            <th>–¢–∏–ø</th>-->
<!--            <th>–ù–∞—Å–µ–ª—ë–Ω–Ω—ã–π –ø—É–Ω–∫—Ç</th>-->
<!--            <th>–°—Ç–æ–∏–º–æ—Å—Ç—å</th>-->
<!--            <th>–î–µ–π—Å—Ç–≤–∏–µ</th>-->
<!--        </tr>-->
<!--    </thead>-->
<!--    <tbody id="route-tbody"></tbody>-->
<!--</table>-->

<!--<script>-->
<!--    var map = L.map('map').setView([60, 40], 6);-->
<!--    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {-->
<!--        attribution: '&copy; OpenStreetMap contributors'-->
<!--    }).addTo(map);-->

<!--    var enterprises = {{ enterprises | tojson }};-->
<!--    var timber_enterprises = {{ timber_enterprises | tojson }};-->
<!--    var consumers = {{ consumers | tojson }};-->

<!--    var supplierIcon = L.divIcon({ html: '<div style="width: 20px; height: 20px; background-color: green;"></div>' });-->
<!--    var consumerIcon = L.divIcon({ html: '<div style="width: 20px; height: 20px; background-color: blue; border-radius: 50%;"></div>' });-->

<!--    var allEnterpriseMarkers = [];-->
<!--    var allSupplierMarkers = [];-->
<!--    var allConsumerMarkers = [];-->
<!--    var activeRoutes = [];-->

<!--    function createMarker(entity, type) {-->
<!--        if (!entity[2]) return;-->
<!--        let lon = entity[2][0], lat = entity[2][1];-->
<!--        let marker;-->

<!--        if (type === "–ü–æ—Å—Ç–∞–≤—â–∏–∫") {-->
<!--            marker = L.marker([lat, lon], { icon: supplierIcon }).addTo(map);-->
<!--            allSupplierMarkers.push(marker);-->
<!--        } else if (type === "–ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å") {-->
<!--            marker = L.marker([lat, lon], { icon: consumerIcon }).addTo(map);-->
<!--            allConsumerMarkers.push(marker);-->
<!--        } else {-->
<!--            marker = L.marker([lat, lon], { draggable: true }).addTo(map);-->
<!--            allEnterpriseMarkers.push(marker);-->

<!--            marker.on('dragend', function(e) {-->
<!--                var latlng = e.target.getLatLng();-->
<!--                updateMarkerLocation(entity[0], latlng.lat, latlng.lng);-->
<!--                updateCityName(entity[0], latlng.lat, latlng.lng);-->
<!--            });-->
<!--        }-->

<!--        fetchLocationName(lat, lon, function(city) {-->
<!--            marker.bindPopup('<b>' + entity[1] + '</b><br>' + city);-->
<!--            addRow(entity[0], entity[1], type, city, marker.getLatLng(), entity[3]);-->
<!--        });-->

<!--        return marker;-->
<!--    }-->

<!--    function fetchLocationName(lat, lon, callback) {-->
<!--        const url = `https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}`;-->
<!--        fetch(url)-->
<!--            .then(res => res.json())-->
<!--            .then(data => {-->
<!--                let city = data.address?.city || data.address?.town || data.address?.village || "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ";-->
<!--                callback(city);-->
<!--            })-->
<!--            .catch(() => callback("–û—à–∏–±–∫–∞"));-->
<!--    }-->

<!--    function updateMarkerLocation(id, lat, lon) {-->
<!--        fetch('/update_location', {-->
<!--            method: 'POST',-->
<!--            headers: { 'Content-Type': 'application/json' },-->
<!--            body: JSON.stringify({ id, type: 'enterprise', lat, lon })-->
<!--        }).catch(err => console.error(err));-->
<!--    }-->

<!--    function updateCityName(id, lat, lon) {-->
<!--        fetchLocationName(lat, lon, city => {-->
<!--            document.getElementById(`loc-${id}`).innerText = city;-->
<!--        });-->
<!--    }-->

<!--    function addRow(id, name, type, city, latlng, cost) {-->
<!--        let tr = document.createElement('tr');-->
<!--        tr.innerHTML =-->
<!--            `<td>${name}</td>-->
<!--            <td>${type}</td>-->
<!--            <td id="loc-${id}">${city}</td>-->
<!--            <td>${cost || '-'}</td>-->
<!--            <td>${type === "–ü—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–µ" ? `<button onclick="saveNewLocation(${id}, ${latlng.lat}, ${latlng.lng})">–í—ã–±—Ä–∞—Ç—å</button>` : ''}</td>`;-->
<!--        document.getElementById('route-tbody').appendChild(tr);-->
<!--    }-->

<!--    function saveNewLocation(id, lat, lon) {-->
<!--        updateMarkerLocation(id, lat, lon);-->
<!--    }-->

<!--    function drawSupplierRoutes() {-->
<!--        allEnterpriseMarkers.forEach(ent => {-->
<!--            const entLatLng = ent.getLatLng();-->
<!--            allSupplierMarkers.forEach(sup => {-->
<!--                const supLatLng = sup.getLatLng();-->
<!--                if (!entLatLng || !supLatLng) return; // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç-->

<!--                const control = L.Routing.control({-->
<!--                    waypoints: [[supLatLng.lat, supLatLng.lng], [entLatLng.lat, entLatLng.lng]],-->
<!--                    lineOptions: { styles: [{ color: 'red', weight: 4 }] },-->
<!--                    router: L.Routing.osrmv1({ serviceUrl: 'https://router.project-osrm.org/route/v1' }),-->
<!--                    createMarker: () => null,-->
<!--                    addWaypoints: false,-->
<!--                    draggableWaypoints: false-->
<!--                }).addTo(map);-->
<!--                activeRoutes.push(control);-->
<!--                addCarAnimation(control, "–ø–µ—Ä–µ–≤–æ–∑–∏—Ç –µ–ª–∫–∏");-->
<!--            });-->
<!--        });-->
<!--    }-->

<!--    function drawConsumerRoutes() {-->
<!--        allEnterpriseMarkers.forEach(ent => {-->
<!--            const entLatLng = ent.getLatLng();-->
<!--            allConsumerMarkers.forEach(con => {-->
<!--                const conLatLng = con.getLatLng();-->
<!--                if (!entLatLng || !conLatLng) return; // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç-->

<!--                const control = L.Routing.control({-->
<!--                    waypoints: [[entLatLng.lat, entLatLng.lng], [conLatLng.lat, conLatLng.lng]],-->
<!--                    lineOptions: { styles: [{ color: 'yellow', weight: 4 }] },-->
<!--                    router: L.Routing.osrmv1({ serviceUrl: 'https://router.project-osrm.org/route/v1' }),-->
<!--                    createMarker: () => null,-->
<!--                    addWaypoints: false,-->
<!--                    draggableWaypoints: false-->
<!--                }).addTo(map);-->
<!--                activeRoutes.push(control);-->
<!--                addCarAnimation(control, "–ø–µ—Ä–µ–≤–æ–∑–∏—Ç —à–∫–∞—Ñ");-->
<!--            });-->
<!--        });-->
<!--    }-->

<!--    function addCarAnimation(control, cargoType) {-->
<!--        const carIcon = L.icon({-->
<!--            iconUrl: '/path_to_car_icon.png',-->
<!--            iconSize: [32, 32]-->
<!--        });-->
<!--        const carMarker = L.marker(control.getWaypoints()[0], { icon: carIcon }).addTo(map);-->

<!--        let currentIndex = 0;-->
<!--        const route = control.getWaypoints();-->
<!--        function moveCar() {-->
<!--            if (currentIndex < route.length) {-->
<!--                carMarker.setLatLng(route[currentIndex]);-->
<!--                currentIndex++;-->
<!--                setTimeout(moveCar, 1000); // –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ –ø—É—Ç–∏-->
<!--            }-->
<!--        }-->
<!--        moveCar();-->
<!--    }-->

<!--    function clearRoutes() {-->
<!--        activeRoutes.forEach(route => map.removeControl(route));-->
<!--        activeRoutes = [];-->
<!--    }-->

<!--    enterprises.forEach(e => createMarker(e, "–ü—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–µ"));-->
<!--    timber_enterprises.forEach(t => createMarker(t, "–ü–æ—Å—Ç–∞–≤—â–∏–∫"));-->
<!--    consumers.forEach(c => createMarker(c, "–ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å"));-->
<!--</script>-->
<!--</body>-->
<!--</html>-->

<!--<!DOCTYPE html>-->
<!--<html lang="ru">-->
<!--<head>-->
<!--    <meta charset="UTF-8">-->
<!--    <title>–ö–∞—Ä—Ç–∞ –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–π</title>-->
<!--    <meta name="viewport" content="width=device-width, initial-scale=1.0">-->

<!--    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.8.0/dist/leaflet.css" />-->
<!--    <script src="https://unpkg.com/leaflet@1.8.0/dist/leaflet.js"></script>-->

<!--    &lt;!&ndash; Leaflet Routing Machine &ndash;&gt;-->
<!--    <link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine/dist/leaflet-routing-machine.css" />-->
<!--    <script src="https://unpkg.com/leaflet-routing-machine/dist/leaflet-routing-machine.min.js"></script>-->

<!--    <style>-->
<!--        body {-->
<!--            font-family: Arial, sans-serif;-->
<!--            background-color: #f4f4f4;-->
<!--            text-align: center;-->
<!--            margin: 0;-->
<!--            padding: 0;-->
<!--        }-->
<!--        h1 { margin: 10px 0; }-->
<!--        #map {-->
<!--            width: 100%;-->
<!--            height: 60vh;-->
<!--            max-width: 1200px;-->
<!--            margin: auto;-->
<!--            border-radius: 8px;-->
<!--        }-->
<!--        table {-->
<!--            width: 95%;-->
<!--            max-width: 1200px;-->
<!--            margin: 15px auto;-->
<!--            border-collapse: collapse;-->
<!--            background: white;-->
<!--            border-radius: 8px;-->
<!--        }-->
<!--        th, td {-->
<!--            padding: 10px;-->
<!--            border: 1px solid #ddd;-->
<!--        }-->
<!--        th {-->
<!--            background-color: #007bff;-->
<!--            color: white;-->
<!--        }-->
<!--        button {-->
<!--            margin: 5px;-->
<!--            padding: 8px 12px;-->
<!--            border-radius: 5px;-->
<!--            border: none;-->
<!--            cursor: pointer;-->
<!--        }-->
<!--        .btn-red { background-color: #dc3545; color: white; }-->
<!--        .btn-yellow { background-color: #ffc107; }-->
<!--        .btn-clear { background-color: #6c757d; color: white; }-->
<!--    </style>-->
<!--</head>-->
<!--<body>-->
<!--<h1>–ö–∞—Ä—Ç–∞ –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–π</h1>-->

<!--<div>-->
<!--    <button class="btn-red" onclick="drawSupplierRoutes()">üî¥ –ú–∞—Ä—à—Ä—É—Ç—ã: –ü–æ—Å—Ç–∞–≤—â–∏–∫–∏</button>-->
<!--    <button class="btn-yellow" onclick="drawConsumerRoutes()">üü° –ú–∞—Ä—à—Ä—É—Ç—ã: –ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏</button>-->
<!--    <button class="btn-clear" onclick="clearRoutes()">‚ùå –û—á–∏—Å—Ç–∏—Ç—å –º–∞—Ä—à—Ä—É—Ç—ã</button>-->
<!--</div>-->

<!--<div id="map"></div>-->

<!--<table>-->
<!--    <thead>-->
<!--        <tr>-->
<!--            <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>-->
<!--            <th>–¢–∏–ø</th>-->
<!--            <th>–ù–∞—Å–µ–ª—ë–Ω–Ω—ã–π –ø—É–Ω–∫—Ç</th>-->
<!--            <th>–°—Ç–æ–∏–º–æ—Å—Ç—å</th>-->
<!--            <th>–î–µ–π—Å—Ç–≤–∏–µ</th>-->
<!--        </tr>-->
<!--    </thead>-->
<!--    <tbody id="route-tbody"></tbody>-->
<!--</table>-->

<!--<script>-->
<!--    var map = L.map('map').setView([60, 40], 6);-->
<!--    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {-->
<!--        attribution: '&copy; OpenStreetMap contributors'-->
<!--    }).addTo(map);-->

<!--    var enterprises = {{ enterprises | tojson }};-->
<!--    var timber_enterprises = {{ timber_enterprises | tojson }};-->
<!--    var consumers = {{ consumers | tojson }};-->

<!--    var supplierIcon = L.divIcon({ html: '<div style="width: 20px; height: 20px; background-color: green;"></div>' });-->
<!--    var consumerIcon = L.divIcon({ html: '<div style="width: 20px; height: 20px; background-color: blue; border-radius: 50%;"></div>' });-->

<!--    var allEnterpriseMarkers = [];-->
<!--    var allSupplierMarkers = [];-->
<!--    var allConsumerMarkers = [];-->
<!--    var activeRoutes = [];-->

<!--    function createMarker(entity, type) {-->
<!--        if (!entity[2]) return;-->
<!--        let lon = entity[2][0], lat = entity[2][1];-->
<!--        let marker;-->

<!--        if (type === "–ü–æ—Å—Ç–∞–≤—â–∏–∫") {-->
<!--            marker = L.marker([lat, lon], { icon: supplierIcon }).addTo(map);-->
<!--            allSupplierMarkers.push(marker);-->
<!--        } else if (type === "–ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å") {-->
<!--            marker = L.marker([lat, lon], { icon: consumerIcon }).addTo(map);-->
<!--            allConsumerMarkers.push(marker);-->
<!--        } else {-->
<!--            marker = L.marker([lat, lon], { draggable: true }).addTo(map);-->
<!--            allEnterpriseMarkers.push(marker);-->

<!--            marker.on('dragend', function(e) {-->
<!--                var latlng = e.target.getLatLng();-->
<!--                updateMarkerLocation(entity[0], latlng.lat, latlng.lng);-->
<!--                updateCityName(entity[0], latlng.lat, latlng.lng);-->
<!--            });-->
<!--        }-->

<!--        fetchLocationName(lat, lon, function(city) {-->
<!--            marker.bindPopup(`<b>${entity[1]}</b><br>${city}`);-->
<!--            addRow(entity[0], entity[1], type, city, marker.getLatLng(), entity[3]);-->
<!--        });-->

<!--        return marker;-->
<!--    }-->

<!--    function fetchLocationName(lat, lon, callback) {-->
<!--        const url = `https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}`;-->
<!--        fetch(url)-->
<!--            .then(res => res.json())-->
<!--            .then(data => {-->
<!--                let city = data.address?.city || data.address?.town || data.address?.village || "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ";-->
<!--                callback(city);-->
<!--            })-->
<!--            .catch(() => callback("–û—à–∏–±–∫–∞"));-->
<!--    }-->

<!--    function updateMarkerLocation(id, lat, lon) {-->
<!--        fetch('/update_location', {-->
<!--            method: 'POST',-->
<!--            headers: { 'Content-Type': 'application/json' },-->
<!--            body: JSON.stringify({ id, type: 'enterprise', lat, lon })-->
<!--        }).catch(err => console.error(err));-->
<!--    }-->

<!--    function updateCityName(id, lat, lon) {-->
<!--        fetchLocationName(lat, lon, city => {-->
<!--            document.getElementById(`loc-${id}`).innerText = city;-->
<!--        });-->
<!--    }-->

<!--    function addRow(id, name, type, city, latlng, cost) {-->
<!--        let tr = document.createElement('tr');-->
<!--        tr.innerHTML = `-->
<!--            <td>${name}</td>-->
<!--            <td>${type}</td>-->
<!--            <td id="loc-${id}">${city}</td>-->
<!--            <td>${cost || '-'}</td>-->
<!--            <td>${type === "–ü—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–µ" ? `<button onclick="saveNewLocation(${id}, ${latlng.lat}, ${latlng.lng})">–í—ã–±—Ä–∞—Ç—å</button>` : ''}</td>-->
<!--        `;-->
<!--        document.getElementById('route-tbody').appendChild(tr);-->
<!--    }-->

<!--    function saveNewLocation(id, lat, lon) {-->
<!--        updateMarkerLocation(id, lat, lon);-->
<!--    }-->

<!--function drawSupplierRoutes() {-->
<!--    allEnterpriseMarkers.forEach(ent => {-->
<!--        const entLatLng = ent.getLatLng();-->
<!--        allSupplierMarkers.forEach(sup => {-->
<!--            const supLatLng = sup.getLatLng();-->
<!--            if (!entLatLng || !supLatLng) return; // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç-->

<!--            // –Ω–µ –º–µ–Ω—è—è –ø–æ—Ä—è–¥–æ–∫ lat –∏ lon –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏, –Ω–æ –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –∏—Ö –≤ –Ω—É–∂–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç-->
<!--            console.log(`–ü–æ—Å—Ç–∞–≤—â–∏–∫: ${supLatLng} - –ü—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–µ: ${entLatLng}`);-->
<!--            const control = L.Routing.control({-->
<!--                waypoints: [[supLatLng.lat, supLatLng.lng], [entLatLng.lat, entLatLng.lng]], // –ø–æ—Ä—è–¥–æ–∫ lat, lon-->
<!--                lineOptions: { styles: [{ color: 'red', weight: 4 }] },-->
<!--                router: L.Routing.osrmv1({ serviceUrl: 'https://router.project-osrm.org/route/v1' }),-->
<!--                createMarker: () => null,-->
<!--                addWaypoints: false,-->
<!--                draggableWaypoints: false-->
<!--            }).addTo(map);-->
<!--            activeRoutes.push(control);-->
<!--        });-->
<!--    });-->
<!--}-->

<!--function drawConsumerRoutes() {-->
<!--    allEnterpriseMarkers.forEach(ent => {-->
<!--        const entLatLng = ent.getLatLng();-->
<!--        allConsumerMarkers.forEach(con => {-->
<!--            const conLatLng = con.getLatLng();-->
<!--            if (!entLatLng || !conLatLng) return; // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç-->

<!--            console.log(`–ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å: ${conLatLng} - –ü—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–µ: ${entLatLng}`);-->
<!--            const control = L.Routing.control({-->
<!--                waypoints: [[entLatLng.lat, entLatLng.lng], [conLatLng.lat, conLatLng.lng]], // –ø–æ—Ä—è–¥–æ–∫ lat, lon-->
<!--                lineOptions: { styles: [{ color: 'yellow', weight: 4 }] },-->
<!--                router: L.Routing.osrmv1({ serviceUrl: 'https://router.project-osrm.org/route/v1' }),-->
<!--                createMarker: () => null,-->
<!--                addWaypoints: false,-->
<!--                draggableWaypoints: false-->
<!--            }).addTo(map);-->
<!--            activeRoutes.push(control);-->
<!--        });-->
<!--    });-->
<!--}-->


<!--    function clearRoutes() {-->
<!--        activeRoutes.forEach(route => map.removeControl(route));-->
<!--        activeRoutes = [];-->
<!--    }-->

<!--    enterprises.forEach(e => createMarker(e, "–ü—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–µ"));-->
<!--    timber_enterprises.forEach(t => createMarker(t, "–ü–æ—Å—Ç–∞–≤—â–∏–∫"));-->
<!--    consumers.forEach(c => createMarker(c, "–ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å"));-->
<!--</script>-->
<!--</body>-->
<!--</html>-->


<!--<!DOCTYPE html>-->
<!--<html lang="ru">-->
<!--<head>-->
<!--    <meta charset="UTF-8">-->
<!--    <meta name="viewport" content="width=device-width, initial-scale=1.0">-->
<!--    <title>–ö–∞—Ä—Ç–∞ –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–π</title>-->
<!--    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.8.0/dist/leaflet.css" />-->
<!--    <script src="https://unpkg.com/leaflet@1.8.0/dist/leaflet.js"></script>-->

<!--    <style>-->
<!--        body {-->
<!--            font-family: Arial, sans-serif;-->
<!--            margin: 0;-->
<!--            padding: 0;-->
<!--            background-color: #f4f4f4;-->
<!--            text-align: center;-->
<!--        }-->
<!--        h1 {-->
<!--            margin-top: 10px;-->
<!--        }-->
<!--        #map {-->
<!--            width: 100%;-->
<!--            height: 60vh;-->
<!--            max-width: 1200px;-->
<!--            margin: auto;-->
<!--            border-radius: 8px;-->
<!--        }-->
<!--        table {-->
<!--            width: 95%;-->
<!--            max-width: 1200px;-->
<!--            margin: 15px auto;-->
<!--            border-collapse: collapse;-->
<!--            background: white;-->
<!--            border-radius: 8px;-->
<!--            overflow: hidden;-->
<!--        }-->
<!--        th, td {-->
<!--            padding: 10px;-->
<!--            border: 1px solid #ddd;-->
<!--            text-align: center;-->
<!--        }-->
<!--        th {-->
<!--            background-color: #007bff;-->
<!--            color: white;-->
<!--        }-->
<!--    </style>-->
<!--</head>-->
<!--<body>-->
<!--<h1>–ö–∞—Ä—Ç–∞ –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–π</h1>-->
<!--<div id="map"></div>-->

<!--<table>-->
<!--    <thead>-->
<!--        <tr>-->
<!--            <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>-->
<!--            <th>–¢–∏–ø</th>-->
<!--            <th>–ù–∞—Å–µ–ª—ë–Ω–Ω—ã–π –ø—É–Ω–∫—Ç</th>-->
<!--            <th>–°—Ç–æ–∏–º–æ—Å—Ç—å</th>-->
<!--            <th>–î–µ–π—Å—Ç–≤–∏–µ</th>-->
<!--        </tr>-->
<!--    </thead>-->
<!--    <tbody id="route-tbody"></tbody>-->
<!--</table>-->

<!--<script>-->
<!--    var map = L.map('map').setView([60, 40], 6);-->
<!--    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {-->
<!--        attribution: '&copy; OpenStreetMap contributors'-->
<!--    }).addTo(map);-->

<!--    var enterprises = {{ enterprises | tojson }};-->
<!--    var timber_enterprises = {{ timber_enterprises | tojson }};-->
<!--    var consumers = {{ consumers | tojson }};-->

<!--    var supplierIcon = L.divIcon({ html: '<div style="width: 20px; height: 20px; background-color: green;"></div>' });-->
<!--    var consumerIcon = L.divIcon({ html: '<div style="width: 20px; height: 20px; background-color: blue; border-radius: 50%;"></div>' });-->

<!--    var allEnterpriseMarkers = [];-->
<!--    var allSupplierMarkers = [];-->
<!--    var allConsumerMarkers = [];-->

<!--    function createMarker(entity, type) {-->
<!--        if (!entity[2]) return;-->
<!--        let lon = entity[2][0], lat = entity[2][1];-->
<!--        let marker;-->

<!--        if (type === "–ü–æ—Å—Ç–∞–≤—â–∏–∫") {-->
<!--            marker = L.marker([lat, lon], { icon: supplierIcon }).addTo(map);-->
<!--            allSupplierMarkers.push(marker);-->
<!--        } else if (type === "–ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å") {-->
<!--            marker = L.marker([lon, lat], { icon: consumerIcon }).addTo(map);-->
<!--            allConsumerMarkers.push(marker);-->
<!--        } else {-->
<!--            marker = L.marker([lon, lat], { draggable: true }).addTo(map);-->
<!--            allEnterpriseMarkers.push(marker);-->

<!--            marker.on('dragend', function(e) {-->
<!--                var latlng = e.target.getLatLng();-->
<!--                updateMarkerLocation(entity[0], latlng.lat, latlng.lng);-->
<!--                updateCityName(entity[0], latlng.lat, latlng.lng);-->
<!--            });-->
<!--        }-->

<!--        fetchLocationName(lat, lon, function(city) {-->
<!--            marker.bindPopup(`<b>${entity[1]}</b><br>${city}`);-->
<!--            addRow(entity[0], entity[1], type, city, marker.getLatLng(), entity[3]);-->
<!--        });-->

<!--        return marker;-->
<!--    }-->
<!--function fetchLocationName(lat, lon, callback) {-->
<!--    const url = `https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}`;-->

<!--    fetch(url)-->
<!--        .then(res => {-->
<!--            if (!res.ok) {-->
<!--                throw new Error("–°–µ—Ç–µ–≤–∞—è –æ—à–∏–±–∫–∞");-->
<!--            }-->
<!--            return res.json();-->
<!--        })-->
<!--        .then(data => {-->
<!--            if (data.address) {-->
<!--                let city = data.address.city || data.address.town || data.address.village || "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ";-->
<!--                callback(city);-->
<!--            } else {-->
<!--                callback("–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ");-->
<!--            }-->
<!--        })-->
<!--        .catch(err => {-->
<!--            console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –Ω–∞–∑–≤–∞–Ω–∏—è –ª–æ–∫–∞—Ü–∏–∏:", err);-->
<!--            callback("–û—à–∏–±–∫–∞");-->
<!--        });-->
<!--}-->

<!--&lt;!&ndash;    function fetchLocationName(lat, lon, callback) {&ndash;&gt;-->
<!--&lt;!&ndash;        fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}`)&ndash;&gt;-->
<!--&lt;!&ndash;            .then(res => res.json())&ndash;&gt;-->
<!--&lt;!&ndash;            .then(data => {&ndash;&gt;-->
<!--&lt;!&ndash;                let city = data.address?.city || data.address?.town || data.address?.village || "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ";&ndash;&gt;-->
<!--&lt;!&ndash;                callback(city);&ndash;&gt;-->
<!--&lt;!&ndash;            })&ndash;&gt;-->
<!--&lt;!&ndash;            .catch(() => callback("–û—à–∏–±–∫–∞"));&ndash;&gt;-->
<!--&lt;!&ndash;    }&ndash;&gt;-->

<!--    function updateMarkerLocation(id, lat, lon) {-->
<!--        fetch('/update_location', {-->
<!--            method: 'POST',-->
<!--            headers: { 'Content-Type': 'application/json' },-->
<!--            body: JSON.stringify({ id, type: 'enterprise', lat, lon })-->
<!--        })-->
<!--        .then(res => res.json())-->
<!--        .then(data => console.log(data.message))-->
<!--        .catch(err => console.error(err));-->
<!--    }-->

<!--    function updateCityName(id, lat, lon) {-->
<!--        fetchLocationName(lat, lon, city => {-->
<!--            document.getElementById(`loc-${id}`).innerText = city;-->
<!--        });-->
<!--    }-->

<!--    function addRow(id, name, type, city, latlng, cost) {-->
<!--        let tr = document.createElement('tr');-->
<!--        tr.innerHTML = `-->
<!--            <td>${name}</td>-->
<!--            <td>${type}</td>-->
<!--            <td id="loc-${id}">${city}</td>-->
<!--            <td>${cost || '-'}</td>-->
<!--            <td>${type === "–ü—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–µ" ? `<button onclick="saveNewLocation(${id}, ${latlng.lat}, ${latlng.lng})">–í—ã–±—Ä–∞—Ç—å</button>` : ''}</td>-->
<!--        `;-->
<!--        document.getElementById('route-tbody').appendChild(tr);-->
<!--    }-->

<!--    function saveNewLocation(id, lat, lon) {-->
<!--        updateMarkerLocation(id, lat, lon);-->
<!--    }-->

<!--&lt;!&ndash;    function drawRoute(startLatLng, endLatLng, color) {&ndash;&gt;-->
<!--&lt;!&ndash;        let url = `https://router.project-osrm.org/route/v1/driving/${startLatLng.lng},${startLatLng.lat};${endLatLng.lng},${endLatLng.lat}?overview=full&geometries=geojson`;&ndash;&gt;-->
<!--&lt;!&ndash;        fetch(url)&ndash;&gt;-->
<!--&lt;!&ndash;            .then(res => res.json())&ndash;&gt;-->
<!--&lt;!&ndash;            .then(data => {&ndash;&gt;-->
<!--&lt;!&ndash;                if (data.routes?.length > 0) {&ndash;&gt;-->
<!--&lt;!&ndash;                    L.geoJSON(data.routes[0].geometry, { style: { color, weight: 4 } }).addTo(map);&ndash;&gt;-->
<!--&lt;!&ndash;                }&ndash;&gt;-->
<!--&lt;!&ndash;            });&ndash;&gt;-->
<!--&lt;!&ndash;    }&ndash;&gt;-->

<!--&lt;!&ndash;    enterprises.forEach(e => createMarker(e, "–ü—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–µ"));&ndash;&gt;-->
<!--&lt;!&ndash;    timber_enterprises.forEach(t => createMarker(t, "–ü–æ—Å—Ç–∞–≤—â–∏–∫"));&ndash;&gt;-->
<!--&lt;!&ndash;    consumers.forEach(c => createMarker(c, "–ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å"));&ndash;&gt;-->

<!--&lt;!&ndash;    setTimeout(() => {&ndash;&gt;-->
<!--&lt;!&ndash;        allEnterpriseMarkers.forEach(ent => {&ndash;&gt;-->
<!--&lt;!&ndash;            allSupplierMarkers.forEach(sup => {&ndash;&gt;-->
<!--&lt;!&ndash;                drawRoute(ent.getLatLng(), sup.getLatLng(), 'red');&ndash;&gt;-->
<!--&lt;!&ndash;            });&ndash;&gt;-->
<!--&lt;!&ndash;            allConsumerMarkers.forEach(con => {&ndash;&gt;-->
<!--&lt;!&ndash;                drawRoute(ent.getLatLng(), con.getLatLng(), 'yellow');&ndash;&gt;-->
<!--&lt;!&ndash;            });&ndash;&gt;-->
<!--&lt;!&ndash;        });&ndash;&gt;-->
<!--&lt;!&ndash;    }, 100);&ndash;&gt;-->
<!--function drawRoute(startLatLng, endLatLng, color) {-->
<!--    const url = `https://router.project-osrm.org/route/v1/driving/${startLatLng.lng},${startLatLng.lat};${endLatLng.lng},${endLatLng.lat}?overview=full&geometries=geojson`;-->
<!--    fetch(url)-->
<!--        .then(res => res.json())-->
<!--        .then(data => {-->
<!--            if (data.routes && data.routes.length > 0) {-->
<!--                L.geoJSON(data.routes[0].geometry, { style: { color, weight: 4 } }).addTo(map);-->
<!--            } else {-->
<!--                console.error("–ú–∞—Ä—à—Ä—É—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω –¥–ª—è:", { startLatLng, endLatLng }); // –¥–æ–±–∞–≤–ª–µ–Ω–æ –æ—Ç–ª–∞–¥–æ—á–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ-->
<!--            }-->
<!--        })-->
<!--        .catch(err => {-->
<!--            console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ –º–∞—Ä—à—Ä—É—Ç–∞:", err);-->
<!--        });-->
<!--}-->

<!--// –°–æ–∑–¥–∞–Ω–∏–µ –º–∞—Ä–∫–µ—Ä–æ–≤-->
<!--enterprises.forEach(e => createMarker(e, '–ü—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–µ'));-->
<!--timber_enterprises.forEach(t => createMarker(t, '–ü–æ—Å—Ç–∞–≤—â–∏–∫'));-->
<!--consumers.forEach(c => createMarker(c, '–ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å'));-->

<!--setTimeout(() => {-->
<!--    // –ü—Ä–æ–∫–ª–∞–¥—ã–≤–∞–µ–º –º–∞—Ä—à—Ä—É—Ç—ã –º–µ–∂–¥—É –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏—è–º–∏ –∏ –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞–º–∏-->
<!--    allEnterpriseMarkers.forEach(ent => {-->
<!--        allSupplierMarkers.forEach(sup => {-->
<!--            if (ent.getLatLng() && sup.getLatLng()) { // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç-->
<!--                drawRoute(ent.getLatLng(), sup.getLatLng(), 'red');-->
<!--            } else {-->
<!--                console.warn("–û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –¥–ª—è –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–µ–º –∏–ª–∏ –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–º");-->
<!--            }-->
<!--        });-->
<!--        // –ü—Ä–æ–∫–ª–∞–¥—ã–≤–∞–µ–º –º–∞—Ä—à—Ä—É—Ç—ã –º–µ–∂–¥—É –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏—è–º–∏ –∏ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—è–º–∏-->
<!--        allConsumerMarkers.forEach(con => {-->
<!--            if (ent.getLatLng() && con.getLatLng()) { // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç-->
<!--                drawRoute(ent.getLatLng(), con.getLatLng(), 'yellow');-->
<!--            } else {-->
<!--                console.warn("–û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –¥–ª—è –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏—è –∏–ª–∏ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—è");-->
<!--            }-->
<!--        });-->
<!--    });-->
<!--}, 100); // –¢–∞–π–º–∞—É—Ç, —á—Ç–æ–±—ã –¥–∞—Ç—å –≤—Ä–µ–º—è –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ –º–∞—Ä–∫–µ—Ä–æ–≤-->

<!--</script>-->
<!--</body>-->
<!--</html>-->

<!--<!DOCTYPE html>-->
<!--<html lang="ru">-->
<!--<head>-->
<!--    <meta charset="UTF-8">-->
<!--    <meta name="viewport" content="width=device-width, initial-scale=1.0">-->
<!--    <title>–ö–∞—Ä—Ç–∞ –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–π</title>-->
<!--    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.8.0/dist/leaflet.css" />-->
<!--    <script src="https://unpkg.com/leaflet@1.8.0/dist/leaflet.js"></script>-->

<!--    <style>-->
<!--        body {-->
<!--            font-family: Arial, sans-serif;-->
<!--            margin: 0;-->
<!--            padding: 0;-->
<!--            text-align: center;-->
<!--            background-color: #f4f4f4;-->
<!--        }-->
<!--        h1 {-->
<!--            margin-top: 10px;-->
<!--        }-->
<!--        #map {-->
<!--            width: 100%;-->
<!--            height: 60vh;-->
<!--            max-width: 1200px;-->
<!--            margin: auto;-->
<!--            border-radius: 8px;-->
<!--        }-->
<!--        table {-->
<!--            width: 95%;-->
<!--            max-width: 1200px;-->
<!--            margin: 15px auto;-->
<!--            border-collapse: collapse;-->
<!--            background: white;-->
<!--            border-radius: 8px;-->
<!--            overflow: hidden;-->
<!--        }-->
<!--        th, td {-->
<!--            padding: 10px;-->
<!--            border: 1px solid #ddd;-->
<!--            text-align: center;-->
<!--        }-->
<!--        th {-->
<!--            background-color: #007bff;-->
<!--            color: white;-->
<!--        }-->
<!--        @media (max-width: 768px) {-->
<!--            #map { height: 50vh; }-->
<!--            th, td { font-size: 14px; }-->
<!--        }-->
<!--    </style>-->
<!--</head>-->
<!--<body>-->
<!--<header>-->
<!--    <nav>-->
<!--        <ul>-->
<!--            <li><a href="/">–ì–ª–∞–≤–Ω–∞—è</a></li>-->
<!--        </ul>-->
<!--    </nav>-->
<!--</header>-->
<!--<h1>–ö–∞—Ä—Ç–∞ –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–π</h1>-->
<!--<div id="map"></div>-->

<!--<table id="route-table">-->
<!--    <thead>-->
<!--        <tr>-->
<!--            <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>-->
<!--            <th>–¢–∏–ø</th>-->
<!--            <th>–ù–∞—Å–µ–ª—ë–Ω–Ω—ã–π –ø—É–Ω–∫—Ç</th>-->
<!--            <th>–°—Ç–æ–∏–º–æ—Å—Ç—å</th>-->
<!--        </tr>-->
<!--    </thead>-->
<!--    <tbody id="route-tbody"></tbody>-->
<!--</table>-->

<!--<script>-->
<!--    var map = L.map('map', { maxZoom: 18 }).setView([60, 40], 6);-->
<!--    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {-->
<!--        attribution: '&copy; OpenStreetMap contributors'-->
<!--    }).addTo(map);-->

<!--    var enterprises = {{ enterprises | tojson }};-->
<!--    var timber_enterprises = {{ timber_enterprises | tojson }};-->
<!--    var consumers = {{ consumers | tojson }};-->

<!--    var supplierIcon = L.divIcon({-->
<!--        className: 'supplier-icon',-->
<!--        html: '<div style="width: 20px; height: 20px; background-color: green; border-radius: 0;"></div>'-->
<!--    });-->
<!--    var consumerIcon = L.divIcon({-->
<!--        className: 'consumer-icon',-->
<!--        html: '<div style="width: 20px; height: 20px; background-color: blue; border-radius: 50%;"></div>'-->
<!--    });-->

<!--    var enterpriseMarkers = [];-->
<!--    var supplierMarkers = [];-->
<!--    var consumerMarkers = [];-->

<!--    function createMarker(entity, type) {-->
<!--        if (!entity[2]) return;-->
<!--        var lat = entity[2][1], lon = entity[2][0];-->
<!--        var marker;-->

<!--        if (type === "–ü–æ—Å—Ç–∞–≤—â–∏–∫") {-->
<!--            marker = L.marker([lat, lon], { icon: supplierIcon }).addTo(map);-->
<!--            supplierMarkers.push(marker);-->
<!--        } else if (type === "–ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å") {-->
<!--            marker = L.marker([lon, lat], { icon: consumerIcon }).addTo(map);-->
<!--            consumerMarkers.push(marker);-->
<!--        } else {-->
<!--            marker = L.marker([lon, lat], { draggable: true }).addTo(map);-->
<!--            enterpriseMarkers.push(marker);-->

<!--            // Enable dragging-->
<!--            marker.on('dragend', function(e) {-->
<!--                var latlng = e.target.getLatLng();-->
<!--                updateMarkerLocation(entity[0], latlng.lat, latlng.lng);-->
<!--                addRow(entity[0], entity[1], type, "–ù–æ–≤—ã–π –≥–æ—Ä–æ–¥", latlng, entity[3]);-->
<!--            });-->
<!--        }-->

<!--        fetchLocationName(lat, lon, function(city) {-->
<!--            marker.bindPopup(`<b>${entity[1]}</b><br>${city}`).openPopup();-->
<!--            addRow(entity[0], entity[1], type, city, marker.getLatLng(), entity[3]);-->
<!--        });-->

<!--        return marker;-->
<!--    }-->

<!--    function addRow(id, name, type, locationName, latlng, cost) {-->
<!--        var row = document.createElement('tr');-->
<!--        row.setAttribute('id', `row-${id}`);-->
<!--        row.innerHTML = `<td>${name}</td><td>${type}</td><td id="loc-${id}">${locationName}</td><td>${cost}</td>`;-->
<!--        document.getElementById('route-tbody').appendChild(row);-->

<!--        if (type === "–ü—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–µ") {-->
<!--            var button = document.createElement('button');-->
<!--            button.textContent = "–í—ã–±—Ä–∞—Ç—å";-->
<!--            button.onclick = function() {-->
<!--                saveNewLocation(id, latlng);-->
<!--            };-->
<!--            row.appendChild(button);-->
<!--        }-->
<!--    }-->

<!--    function fetchLocationName(lat, lon, callback) {-->
<!--        fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}&zoom=10&addressdetails=1`)-->
<!--        .then(response => response.json())-->
<!--        .then(data => {-->
<!--            let city = "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ";-->
<!--            if (data.address) {-->
<!--                city = data.address.city || data.address.town || data.address.village || "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ";-->
<!--            }-->
<!--            callback(city);-->
<!--        })-->
<!--        .catch(() => callback("–û—à–∏–±–∫–∞"));-->
<!--    }-->

<!--    function drawRoute(start, end, color) {-->
<!--        var url = `https://router.project-osrm.org/route/v1/driving/${start[1]},${start[0]};${end[1]},${end[0]}?overview=full&geometries=geojson`;-->

<!--        fetch(url)-->
<!--        .then(response => response.json())-->
<!--        .then(data => {-->
<!--            if (data.routes && data.routes.length > 0) {-->
<!--                var route = L.geoJSON(data.routes[0].geometry, {-->
<!--                    style: { color: color, weight: 5 }-->
<!--                }).addTo(map);-->
<!--            }-->
<!--        })-->
<!--        .catch(error => console.error('–û—à–∏–±–∫–∞ –º–∞—Ä—à—Ä—É—Ç–∞:', error));-->
<!--    }-->

<!--    function updateMarkerLocation(entityId, lat, lon) {-->
<!--        fetch('/update_location', {-->
<!--            method: 'POST',-->
<!--            headers: { 'Content-Type': 'application/json' },-->
<!--            body: JSON.stringify({ id: entityId, type: 'enterprise', lat: lat, lon: lon })-->
<!--        })-->
<!--        .then(response => response.json())-->
<!--        .then(data => {-->
<!--            console.log('Location updated:', data.message);-->
<!--        })-->
<!--        .catch(error => console.error('Error updating location:', error));-->
<!--    }-->

<!--    function saveNewLocation(id, latlng) {-->
<!--        console.log('Saving new location for enterprise', id, latlng);-->
<!--        updateMarkerLocation(id, latlng.lat, latlng.lng);-->
<!--    }-->

<!--    // Create markers for all entities-->
<!--    var enterpriseMarkers = enterprises.map(e => createMarker(e, "–ü—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–µ"));-->
<!--    var supplierMarkers = timber_enterprises.map(t => createMarker(t, "–ü–æ—Å—Ç–∞–≤—â–∏–∫"));-->
<!--    var consumerMarkers = consumers.map(c => createMarker(c, "–ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å"));-->

<!--    setTimeout(() => {-->
<!--        enterpriseMarkers.forEach(ent => {-->
<!--            if (!ent) return;-->
<!--            var entLatLng = ent.getLatLng();-->

<!--            supplierMarkers.forEach(sup => {-->
<!--                if (!sup) return;-->
<!--                drawRoute([entLatLng.lat, entLatLng.lng], [sup.getLatLng().lat, sup.getLatLng().lng], 'red');-->
<!--            });-->

<!--            consumerMarkers.forEach(con => {-->
<!--                if (!con) return;-->
<!--                drawRoute([entLatLng.lat, entLatLng.lng], [con.getLatLng().lat, con.getLatLng().lng], 'yellow');-->
<!--            });-->
<!--        });-->
<!--    }, 2000);-->
<!--</script>-->
<!--</body>-->
<!--</html>-->



<!--<!DOCTYPE html>-->
<!--<html lang="ru">-->
<!--<head>-->
<!--    <meta charset="UTF-8">-->
<!--    <meta name="viewport" content="width=device-width, initial-scale=1.0">-->
<!--    <title>–ö–∞—Ä—Ç–∞ –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–π</title>-->
<!--    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.8.0/dist/leaflet.css" />-->
<!--    <script src="https://unpkg.com/leaflet@1.8.0/dist/leaflet.js"></script>-->

<!--    <style>-->
<!--        body {-->
<!--            font-family: Arial, sans-serif;-->
<!--            margin: 0;-->
<!--            padding: 0;-->
<!--            text-align: center;-->
<!--            background-color: #f4f4f4;-->
<!--        }-->
<!--        h1 {-->
<!--            margin-top: 10px;-->
<!--        }-->
<!--        #map {-->
<!--            width: 100%;-->
<!--            height: 60vh;-->
<!--            max-width: 1200px;-->
<!--            margin: auto;-->
<!--            border-radius: 8px;-->
<!--        }-->
<!--        table {-->
<!--            width: 95%;-->
<!--            max-width: 1200px;-->
<!--            margin: 15px auto;-->
<!--            border-collapse: collapse;-->
<!--            background: white;-->
<!--            border-radius: 8px;-->
<!--            overflow: hidden;-->
<!--        }-->
<!--        th, td {-->
<!--            padding: 10px;-->
<!--            border: 1px solid #ddd;-->
<!--            text-align: center;-->
<!--        }-->
<!--        th {-->
<!--            background-color: #007bff;-->
<!--            color: white;-->
<!--        }-->
<!--        @media (max-width: 768px) {-->
<!--            #map { height: 50vh; }-->
<!--            th, td { font-size: 14px; }-->
<!--        }-->
<!--    </style>-->
<!--</head>-->
<!--<body>-->
<!-- <header>-->
<!--    <nav>-->
<!--      <ul>-->
<!--        <li><a href="/">–ì–ª–∞–≤–Ω–∞—è</a></li>-->
<!--      </ul>-->
<!--    </nav>-->
<!--  </header>-->
<!--<h1>–ö–∞—Ä—Ç–∞ –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–π</h1>-->
<!--<div id="map"></div>-->

<!--<table id="route-table">-->
<!--    <thead>-->
<!--        <tr>-->
<!--            <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>-->
<!--            <th>–¢–∏–ø</th>-->
<!--            <th>–ù–∞—Å–µ–ª—ë–Ω–Ω—ã–π –ø—É–Ω–∫—Ç</th>-->
<!--        </tr>-->
<!--    </thead>-->
<!--    <tbody id="route-tbody"></tbody>-->
<!--</table>-->

<!--<script>-->
<!--    var map = L.map('map', { maxZoom: 18 }).setView([60, 40], 6);-->
<!--    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {-->
<!--        attribution: '&copy; OpenStreetMap contributors'-->
<!--    }).addTo(map);-->

<!--    var enterprises = {{ enterprises | tojson }};-->
<!--    var timber_enterprises = {{ timber_enterprises | tojson }};-->
<!--    var consumers = {{ consumers | tojson }};-->

<!--    var supplierIcon = L.divIcon({-->
<!--        className: 'supplier-icon',-->
<!--        html: '<div style="width: 20px; height: 20px; background-color: green; border-radius: 0;"></div>'-->
<!--    });-->
<!--    var consumerIcon = L.divIcon({-->
<!--        className: 'consumer-icon',-->
<!--        html: '<div style="width: 20px; height: 20px; background-color: blue; border-radius: 50%;"></div>'-->
<!--    });-->

<!--    function createMarker(entity, type) {-->
<!--        if (!entity[2]) return;-->
<!--        var lat = entity[2][1], lon = entity[2][0];-->
<!--        var marker;-->

<!--        if (type === "–ü–æ—Å—Ç–∞–≤—â–∏–∫") {-->
<!--            marker = L.marker([lat, lon], { icon: supplierIcon }).addTo(map);-->
<!--        } else if (type === "–ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å") {-->
<!--            marker = L.marker([lon, lat], { icon: consumerIcon }).addTo(map);-->
<!--        } else {-->
<!--            marker = L.marker([lon, lat]).addTo(map);-->
<!--        }-->

<!--        fetchLocationName(lat, lon, function(city) {-->
<!--            marker.bindPopup(`<b>${entity[1]}</b><br>${city}`).openPopup();-->
<!--            addRow(entity[0], entity[1], type, city);-->
<!--        });-->

<!--        return marker;-->
<!--    }-->

<!--    function addRow(id, name, type, locationName) {-->
<!--        var row = document.createElement('tr');-->
<!--        row.setAttribute('id', `row-${id}`);-->
<!--        row.innerHTML = `<td>${name}</td><td>${type}</td><td id="loc-${id}">${locationName}</td>`;-->
<!--        document.getElementById('route-tbody').appendChild(row);-->
<!--    }-->

<!--    function fetchLocationName(lat, lon, callback) {-->
<!--        fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}&zoom=10&addressdetails=1`)-->
<!--        .then(response => response.json())-->
<!--        .then(data => {-->
<!--            let city = "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ";-->
<!--            if (data.address) {-->
<!--                city = data.address.city || data.address.town || data.address.village || "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ";-->
<!--            }-->
<!--            callback(city);-->
<!--        })-->
<!--        .catch(() => callback("–û—à–∏–±–∫–∞"));-->
<!--    }-->

<!--    function drawRoute(start, end, color) {-->
<!--        var url = `https://router.project-osrm.org/route/v1/driving/${start[1]},${start[0]};${end[1]},${end[0]}?overview=full&geometries=geojson`;-->

<!--        fetch(url)-->
<!--        .then(response => response.json())-->
<!--        .then(data => {-->
<!--            var route = L.geoJSON(data.routes[0].geometry, {-->
<!--                style: { color: color, weight: 5 }-->
<!--            }).addTo(map);-->
<!--        })-->
<!--        .catch(error => console.error('–û—à–∏–±–∫–∞ –º–∞—Ä—à—Ä—É—Ç–∞:', error));-->
<!--    }-->

<!--    var enterpriseMarkers = enterprises.map(e => createMarker(e, "–ü—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–µ"));-->
<!--    var supplierMarkers = timber_enterprises.map(t => createMarker(t, "–ü–æ—Å—Ç–∞–≤—â–∏–∫"));-->
<!--    var consumerMarkers = consumers.map(c => createMarker(c, "–ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å"));-->

<!--    setTimeout(() => {-->
<!--        enterpriseMarkers.forEach(ent => {-->
<!--            if (!ent) return;-->
<!--            var entLatLng = ent.getLatLng();-->

<!--            supplierMarkers.forEach(sup => {-->
<!--                if (!sup) return;-->
<!--                drawRoute([entLatLng.lat, entLatLng.lng], [sup.getLatLng().lat, sup.getLatLng().lng], 'red');-->
<!--            });-->

<!--            consumerMarkers.forEach(con => {-->
<!--                if (!con) return;-->
<!--                drawRoute([entLatLng.lat, entLatLng.lng], [con.getLatLng().lat, con.getLatLng().lng], 'yellow');-->
<!--            });-->
<!--        });-->
<!--    }, 2000);-->
<!--</script>-->
<!--</body>-->
<!--</html>-->

<!--<!DOCTYPE html>-->
<!--<html lang="ru">-->
<!--<head>-->
<!--    <meta charset="UTF-8">-->
<!--    <meta name="viewport" content="width=device-width, initial-scale=1.0">-->
<!--    <title>–ö–∞—Ä—Ç–∞ –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–π</title>-->
<!--    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.8.0/dist/leaflet.css" />-->
<!--    <script src="https://unpkg.com/leaflet@1.8.0/dist/leaflet.js"></script>-->

<!--    <style>-->
<!--        body {-->
<!--            font-family: Arial, sans-serif;-->
<!--            margin: 0;-->
<!--            padding: 0;-->
<!--            text-align: center;-->
<!--            background-color: #f4f4f4;-->
<!--        }-->
<!--        h1 {-->
<!--            margin-top: 10px;-->
<!--        }-->
<!--        #map {-->
<!--            width: 100%;-->
<!--            height: 60vh;-->
<!--            max-width: 1200px;-->
<!--            margin: auto;-->
<!--            border-radius: 8px;-->
<!--        }-->
<!--        table {-->
<!--            width: 95%;-->
<!--            max-width: 1200px;-->
<!--            margin: 15px auto;-->
<!--            border-collapse: collapse;-->
<!--            background: white;-->
<!--            border-radius: 8px;-->
<!--            overflow: hidden;-->
<!--        }-->
<!--        th, td {-->
<!--            padding: 10px;-->
<!--            border: 1px solid #ddd;-->
<!--            text-align: center;-->
<!--        }-->
<!--        th {-->
<!--            background-color: #007bff;-->
<!--            color: white;-->
<!--        }-->
<!--        @media (max-width: 768px) {-->
<!--            #map { height: 50vh; }-->
<!--            th, td { font-size: 14px; }-->
<!--        }-->
<!--    </style>-->
<!--</head>-->
<!--<body>-->

<!--<h1>–ö–∞—Ä—Ç–∞ –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–π</h1>-->
<!--<div id="map"></div>-->

<!--<table id="route-table">-->
<!--    <thead>-->
<!--        <tr>-->
<!--            <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>-->
<!--            <th>–¢–∏–ø</th>-->
<!--            <th>–ù–∞—Å–µ–ª—ë–Ω–Ω—ã–π –ø—É–Ω–∫—Ç</th>-->
<!--        </tr>-->
<!--    </thead>-->
<!--    <tbody id="route-tbody"></tbody>-->
<!--</table>-->

<!--<script>-->
<!--    var map = L.map('map', { maxZoom: 18 }).setView([60, 40], 6);-->
<!--    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {-->
<!--        attribution: '&copy; OpenStreetMap contributors'-->
<!--    }).addTo(map);-->

<!--    var enterprises = {{ enterprises | tojson }};-->
<!--    var timber_enterprises = {{ timber_enterprises | tojson }};-->
<!--    var consumers = {{ consumers | tojson }};-->

<!--    var supplierIcon = L.divIcon({-->
<!--        className: 'supplier-icon',-->
<!--        html: '<div style="width: 20px; height: 20px; background-color: green; border-radius: 0;"></div>'-->
<!--    });-->
<!--    var consumerIcon = L.divIcon({-->
<!--        className: 'consumer-icon',-->
<!--        html: '<div style="width: 20px; height: 20px; background-color: blue; border-radius: 50%;"></div>'-->
<!--    });-->

<!--    function createMarker(entity, type) {-->
<!--        if (!entity[2]) return;-->
<!--        var lat = entity[2][1], lon = entity[2][0];-->
<!--        var marker;-->

<!--        if (type === "–ü–æ—Å—Ç–∞–≤—â–∏–∫") {-->
<!--            marker = L.marker([lat, lon], { icon: supplierIcon, draggable: true }).addTo(map);-->
<!--        } else if (type === "–ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å") {-->
<!--            marker = L.marker([lon, lat], { icon: consumerIcon, draggable: true }).addTo(map);-->
<!--        } else {-->
<!--            marker = L.marker([lon, lat], { draggable: true }).addTo(map);-->
<!--        }-->

<!--        marker.bindPopup(`<b>${entity[1]}</b><br>(${type})`).openPopup();-->

<!--        fetchLocationName(lat, lon, function(city) {-->
<!--            marker.bindPopup(`<b>${entity[1]}</b><br>${city}`).openPopup();-->
<!--            addRow(entity[0], entity[1], type, city);-->
<!--        });-->

<!--        marker.on('dragend', function (e) {-->
<!--            var newLatLng = e.target.getLatLng();-->
<!--            fetch('/update_location', {-->
<!--                method: 'POST',-->
<!--                headers: { 'Content-Type': 'application/json' },-->
<!--                body: JSON.stringify({-->
<!--                    id: entity[0],-->
<!--                    type: type,-->
<!--                    lat: newLatLng.lat,-->
<!--                    lon: newLatLng.lng-->
<!--                })-->
<!--            })-->
<!--            .then(() => fetchLocationName(newLatLng.lat, newLatLng.lng, function(city) {-->
<!--                marker.bindPopup(`<b>${entity[1]}</b><br>${city}`).openPopup();-->
<!--                updateRow(entity[0], city);-->
<!--            }));-->
<!--        });-->
<!--    }-->

<!--    enterprises.forEach(e => createMarker(e, "–ü—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–µ"));-->
<!--    timber_enterprises.forEach(t => createMarker(t, "–ü–æ—Å—Ç–∞–≤—â–∏–∫"));-->
<!--    consumers.forEach(c => createMarker(c, "–ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å"));-->

<!--    function addRow(id, name, type, locationName) {-->
<!--        var row = document.createElement('tr');-->
<!--        row.setAttribute('id', `row-${id}`);-->
<!--        row.innerHTML = `<td>${name}</td><td>${type}</td><td id="loc-${id}">${locationName}</td>`;-->
<!--        document.getElementById('route-tbody').appendChild(row);-->
<!--    }-->

<!--    function updateRow(id, newLocation) {-->
<!--        var cell = document.getElementById(`loc-${id}`);-->
<!--        if (cell) cell.textContent = newLocation;-->
<!--    }-->

<!--    function fetchLocationName(lat, lon, callback) {-->
<!--        fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}&zoom=10&addressdetails=1`)-->
<!--        .then(response => response.json())-->
<!--        .then(data => {-->
<!--            let city = "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ";-->
<!--            if (data.address) {-->
<!--                city = data.address.city || data.address.town || data.address.village || "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ";-->
<!--            }-->
<!--            callback(city);-->
<!--        })-->
<!--        .catch(() => callback("–û—à–∏–±–∫–∞"));-->
<!--    }-->
<!--</script>-->

<!--</body>-->
<!--</html>-->


<!--<!DOCTYPE html>-->
<!--<html lang="ru">-->
<!--<head>-->
<!--    <meta charset="UTF-8">-->
<!--    <meta name="viewport" content="width=device-width, initial-scale=1.0">-->
<!--    <title>–ö–∞—Ä—Ç–∞ –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–π</title>-->
<!--    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.8.0/dist/leaflet.css" />-->
<!--    <script src="https://unpkg.com/leaflet@1.8.0/dist/leaflet.js"></script>-->
<!--    <script src="https://unpkg.com/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.js"></script>-->
<!--</head>-->
<!--<body>-->

<!--<h1>–ö–∞—Ä—Ç–∞ –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–π</h1>-->
<!--<div id="map" style="width: 100%; height: 600px;"></div>-->

<!--<table id="route-table">-->
<!--    <thead>-->
<!--        <tr>-->
<!--            <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>-->
<!--            <th>–¢–∏–ø</th>-->
<!--            <th>–ù–∞—Å–µ–ª—ë–Ω–Ω—ã–π –ø—É–Ω–∫—Ç</th>-->
<!--        </tr>-->
<!--    </thead>-->
<!--    <tbody id="route-tbody"></tbody>-->
<!--</table>-->

<!--<script>-->
<!--    var map = L.map('map', { maxZoom: 18 }).setView([60, 40], 6);-->
<!--    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {-->
<!--        attribution: '&copy; OpenStreetMap contributors'-->
<!--    }).addTo(map);-->

<!--    var enterprises = {{ enterprises | tojson }};-->
<!--    var timber_enterprises = {{ timber_enterprises | tojson }};-->
<!--    var consumers = {{ consumers | tojson }};-->

<!--    var supplierIcon = L.divIcon({-->
<!--        className: 'supplier-icon',-->
<!--        html: '<div style="width: 20px; height: 20px; background-color: green; border-radius: 0;"></div>'-->
<!--    });-->
<!--    var consumerIcon = L.divIcon({-->
<!--        className: 'consumer-icon',-->
<!--        html: '<div style="width: 20px; height: 20px; background-color: blue; border-radius: 50%;"></div>'-->
<!--    });-->

<!--    function createMarker(entity, type) {-->
<!--        if (!entity[2]) return;-->
<!--        var lat = entity[2][1], lon = entity[2][0];-->
<!--        var marker;-->

<!--        if (type === "–ü–æ—Å—Ç–∞–≤—â–∏–∫") {-->
<!--            marker = L.marker([lat, lon], { icon: supplierIcon, draggable: true }).addTo(map);-->
<!--        } else if (type === "–ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å") {-->
<!--            marker = L.marker([lon, lat], { icon: consumerIcon, draggable: true }).addTo(map);-->
<!--        } else {-->
<!--            marker = L.marker([lon, lat], { draggable: true }).addTo(map);-->
<!--        }-->

<!--        marker.bindPopup(`<b>${entity[1]}</b><br>(${type})`).openPopup();-->

<!--        fetchLocationName(lat, lon, function(city) {-->
<!--            marker.bindPopup(`<b>${entity[1]}</b><br>${city}`).openPopup();-->
<!--            addRow(entity[0], entity[1], type, city);-->
<!--        });-->

<!--        marker.on('dragend', function (e) {-->
<!--            var newLatLng = e.target.getLatLng();-->
<!--            fetch('/update_location', {-->
<!--                method: 'POST',-->
<!--                headers: { 'Content-Type': 'application/json' },-->
<!--                body: JSON.stringify({-->
<!--                    id: entity[0],-->
<!--                    type: type,-->
<!--                    lat: newLatLng.lat,-->
<!--                    lon: newLatLng.lng-->
<!--                })-->
<!--            })-->
<!--            .then(() => fetchLocationName(newLatLng.lat, newLatLng.lng, function(city) {-->
<!--                marker.bindPopup(`<b>${entity[1]}</b><br>${city}`).openPopup();-->
<!--                updateRow(entity[0], city);-->
<!--            }));-->
<!--        });-->
<!--    }-->

<!--    enterprises.forEach(e => createMarker(e, "–ü—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–µ"));-->
<!--    timber_enterprises.forEach(t => createMarker(t, "–ü–æ—Å—Ç–∞–≤—â–∏–∫"));-->
<!--    consumers.forEach(c => createMarker(c, "–ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å"));-->

<!--    function drawRoutes() {-->
<!--        timber_enterprises.forEach(timber => {-->
<!--            enterprises.forEach(enterprise => {-->
<!--                drawCarRoute(timber[2], enterprise[2], 'yellow');-->
<!--            });-->
<!--        });-->
<!--        enterprises.forEach(enterprise => {-->
<!--            consumers.forEach(consumer => {-->
<!--                drawCarRoute(enterprise[2], consumer[2], 'red');-->
<!--            });-->
<!--        });-->
<!--    }-->

<!--    function drawCarRoute(start, end, color) {-->
<!--        if (!start || !end) return;-->
<!--        L.Routing.control({-->
<!--            waypoints: [-->
<!--                L.latLng(start[1], start[0]),-->
<!--                L.latLng(end[1], end[0])-->
<!--            ],-->
<!--            routeWhileDragging: true,-->
<!--            router: L.Routing.osrmv1({-->
<!--                serviceUrl: 'https://router.project-osrm.org/route/v1'-->
<!--            }),-->
<!--            lineOptions: {-->
<!--                styles: [{ color: color, weight: 4 }]-->
<!--            },-->
<!--            createMarker: function() { return null; }-->
<!--        }).addTo(map);-->
<!--    }-->
<!--    drawRoutes();-->

<!--    function addRow(id, name, type, locationName) {-->
<!--        var row = document.createElement('tr');-->
<!--        row.setAttribute('id', `row-${id}`);-->
<!--        row.innerHTML = `<td>${name}</td><td>${type}</td><td id="loc-${id}">${locationName}</td>`;-->
<!--        document.getElementById('route-tbody').appendChild(row);-->
<!--    }-->

<!--    function updateRow(id, newLocation) {-->
<!--        var cell = document.getElementById(`loc-${id}`);-->
<!--        if (cell) cell.textContent = newLocation;-->
<!--    }-->

<!--    function fetchLocationName(lat, lon, callback) {-->
<!--        fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}&zoom=10&addressdetails=1`)-->
<!--        .then(response => response.json())-->
<!--        .then(data => {-->
<!--            let city = "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ";-->
<!--            if (data.address) {-->
<!--                city = data.address.city || data.address.town || data.address.village || "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ";-->
<!--            }-->
<!--            callback(city);-->
<!--        })-->
<!--        .catch(() => callback("–û—à–∏–±–∫–∞"));-->
<!--    }-->
<!--</script>-->
<!--</body>-->
<!--</html>-->





<!--<!DOCTYPE html>-->
<!--<html lang="ru">-->
<!--<head>-->
<!--    <meta charset="UTF-8">-->
<!--    <meta name="viewport" content="width=device-width, initial-scale=1.0">-->
<!--    <title>–ö–∞—Ä—Ç–∞ –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–π</title>-->
<!--    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.8.0/dist/leaflet.css" />-->
<!--    <style>-->
<!--        #map { width: 100%; height: 600px; }-->
<!--        body {-->
<!--            font-family: Arial, sans-serif;-->
<!--            margin: 0;-->
<!--            padding: 0;-->
<!--            background-color: #f0f5f3;-->
<!--            color: #2c5b4b;-->
<!--        }-->
<!--        header {-->
<!--            background-color: #6dbd9e;-->
<!--            color: white;-->
<!--            padding: 20px;-->
<!--            text-align: center;-->
<!--        }-->
<!--        main {-->
<!--            padding: 20px;-->
<!--        }-->
<!--        .route-info {-->
<!--            background-color: #f1f1f1;-->
<!--            padding: 10px;-->
<!--            margin-bottom: 10px;-->
<!--        }-->
<!--        #route-table {-->
<!--            margin-top: 20px;-->
<!--            width: 100%;-->
<!--            border-collapse: collapse;-->
<!--        }-->
<!--        #route-table th, #route-table td {-->
<!--            border: 1px solid #ddd;-->
<!--            padding: 8px;-->
<!--        }-->
<!--    </style>-->
<!--</head>-->
<!--<body>-->

<!--<header>-->
<!--    <h1>–ö–∞—Ä—Ç–∞ –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–π</h1>-->
<!--</header>-->

<!--<main>-->
<!--    <div id="map"></div>-->
<!--    <div id="route-info-container"></div>-->
<!--    <table id="route-table">-->
<!--        <thead>-->
<!--            <tr>-->
<!--                <th>–ü—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–µ</th>-->
<!--                <th>–õ–µ—Å–æ–∑–∞–≥–æ—Ç–æ–≤–∏—Ç–µ–ª—å</th>-->
<!--                <th>–ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å</th>-->
<!--                <th>–†–∞—Å—Å—Ç–æ—è–Ω–∏–µ (–∫–º)</th>-->
<!--                <th>–í—Ä–µ–º—è –≤ –ø—É—Ç–∏ (—á)</th>-->
<!--                <th>–í–º–µ—Å—Ç–∏–º–æ—Å—Ç—å (—Ç–æ–Ω–Ω)</th>-->
<!--            </tr>-->
<!--        </thead>-->
<!--        <tbody id="route-tbody"></tbody>-->
<!--    </table>-->
<!--</main>-->

<!--<footer>-->
<!--    <p>&copy; 2024 –°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–µ–º. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.</p>-->
<!--</footer>-->

<!--<script src="https://unpkg.com/leaflet@1.8.0/dist/leaflet.js"></script>-->
<!--<script>-->
<!--    var map = L.map('map').setView([62.5, 34.5], 8);-->

<!--    // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–ª–æ—è OpenStreetMap-->
<!--    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {-->
<!--        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'-->
<!--    }).addTo(map);-->

<!--    var markers = L.featureGroup().addTo(map);-->
<!--    var routingControl;-->
<!--    var enterprises = {{ enterprises | tojson }};-->
<!--    var timber_enterprises = {{ timber_enterprises | tojson }};-->
<!--    var consumers = {{ consumers | tojson }};-->

<!--    // –î–æ–±–∞–≤–ª—è–µ–º –º–∞—Ä–∫–µ—Ä—ã –¥–ª—è –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–π-->
<!--    enterprises.forEach(function(enterprise) {-->
<!--        var latLng = enterprise[2].split(',').map(Number); // –†–∞–∑–¥–µ–ª—è–µ–º —Å—Ç—Ä–æ–∫—É –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –Ω–∞ –º–∞—Å—Å–∏–≤-->
<!--        var marker = L.marker(latLng).addTo(map);-->
<!--        marker.bindPopup('–ü—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–µ: ' + enterprise[1]);-->
<!--        markers.addLayer(marker);-->
<!--    });-->

<!--    // –î–æ–±–∞–≤–ª—è–µ–º –º–∞—Ä–∫–µ—Ä—ã –¥–ª—è –ª–µ—Å–æ–∑–∞–≥–æ—Ç–æ–≤–∏—Ç–µ–ª–µ–π-->
<!--    timber_enterprises.forEach(function(timber) {-->
<!--        var latLng = timber[2].split(',').map(Number);-->
<!--        var marker = L.marker(latLng).addTo(map);-->
<!--        marker.bindPopup('–õ–µ—Å–æ–∑–∞–≥–æ—Ç–æ–≤–∏—Ç–µ–ª—å: ' + timber[1]);-->
<!--        markers.addLayer(marker);-->
<!--    });-->

<!--    // –î–æ–±–∞–≤–ª—è–µ–º –º–∞—Ä–∫–µ—Ä—ã –¥–ª—è –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–µ–π-->
<!--    consumers.forEach(function(consumer) {-->
<!--        var latLng = consumer[2].split(',').map(Number);-->
<!--        var marker = L.marker(latLng).addTo(map);-->
<!--        marker.bindPopup('–ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å: ' + consumer[1]);-->
<!--        markers.addLayer(marker);-->
<!--    });-->

<!--    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ –º–∞—Ä—à—Ä—É—Ç–∞-->
<!--    function calculateRoute() {-->
<!--        var markerCoords = markers.getLayers().map(function(marker) {-->
<!--            return marker.getLatLng();-->
<!--        });-->

<!--        // –û—á–∏—Å—Ç–∫–∞ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –º–∞—Ä—à—Ä—É—Ç–∞-->
<!--        if (routingControl) {-->
<!--            map.removeControl(routingControl);-->
<!--        }-->

<!--        // –°—Ç—Ä–æ–∏–º –Ω–æ–≤—ã–π –º–∞—Ä—à—Ä—É—Ç-->
<!--        routingControl = L.Routing.control({-->
<!--            waypoints: markerCoords,-->
<!--            routeWhileDragging: true-->
<!--        }).addTo(map);-->

<!--        // –ö–æ–≥–¥–∞ –º–∞—Ä—à—Ä—É—Ç –Ω–∞–π–¥–µ–Ω, –æ–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤ —Ç–∞–±–ª–∏—Ü–µ-->
<!--        routingControl.on('routesfound', function(e) {-->
<!--            var route = e.routes[0];-->
<!--            var distance = (route.summary.totalDistance / 1000).toFixed(2); // –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ –≤ –∫–º-->
<!--            var travelTime = (route.summary.totalTime / 3600).toFixed(2); // –í—Ä–µ–º—è –≤ –ø—É—Ç–∏ –≤ —á–∞—Å–∞—Ö-->
<!--            var capacity = (distance * 10).toFixed(2); // –ü—Ä–∏–º–µ—Ä–Ω—ã–π —Ä–∞—Å—á–µ—Ç –≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏, —É–º–Ω–æ–∂–∏–≤ –Ω–∞ 10-->

<!--            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã-->
<!--            var tableBody = document.getElementById('route-tbody');-->
<!--            var row = document.createElement('tr');-->
<!--            row.innerHTML = `-->
<!--                <td>–ü—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–µ 1</td>-->
<!--                <td>–õ–µ—Å–æ–∑–∞–≥–æ—Ç–æ–≤–∏—Ç–µ–ª—å 1</td>-->
<!--                <td>–ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å 1</td>-->
<!--                <td>${distance} –∫–º</td>-->
<!--                <td>${travelTime} —á</td>-->
<!--                <td>${capacity} —Ç–æ–Ω–Ω</td>-->
<!--            `;-->
<!--            tableBody.appendChild(row);-->

<!--            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –º–∞—Ä—à—Ä—É—Ç-->
<!--            fetch('/save_route', {-->
<!--                method: 'POST',-->
<!--                headers: {-->
<!--                    'Content-Type': 'application/json'-->
<!--                },-->
<!--                body: JSON.stringify({-->
<!--                    distance: distance,-->
<!--                    travel_time: travelTime,-->
<!--                    capacity: capacity-->
<!--                })-->
<!--            })-->
<!--            .then(response => response.json())-->
<!--            .then(data => {-->
<!--                console.log('–ú–∞—Ä—à—Ä—É—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω:', data);-->
<!--            })-->
<!--            .catch(error => console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –º–∞—Ä—à—Ä—É—Ç–∞:', error));-->
<!--        });-->
<!--    }-->

<!--    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ –º–∞—Ä—à—Ä—É—Ç–∞-->
<!--    map.on('click', function() {-->
<!--        calculateRoute();-->
<!--    });-->

<!--</script>-->
<!--</body>-->
<!--</html>-->


<!--<!DOCTYPE html>-->
<!--<html>-->
<!--<head>-->
<!--  <title>–ö–∞—Ä—Ç–∞ –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–π</title>-->
<!--  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.8.0/dist/leaflet.css" />-->
<!--  <link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.css" />-->
<!--  <style>-->
<!--    #map {-->
<!--      width: 100%;-->
<!--      height: 600px;-->
<!--    }-->
<!--    body {-->
<!--      font-family: Arial, sans-serif;-->
<!--      margin: 0;-->
<!--      padding: 0;-->
<!--      background-color: #f0f5f3;-->
<!--      color: #2c5b4b;-->
<!--    }-->
<!--    header {-->
<!--      background-color: #6dbd9e;-->
<!--      color: white;-->
<!--      padding: 20px;-->
<!--      text-align: center;-->
<!--    }-->
<!--    nav ul {-->
<!--      list-style-type: none;-->
<!--      margin: 0;-->
<!--      padding: 0;-->
<!--      display: flex;-->
<!--      justify-content: center;-->
<!--    }-->
<!--    nav li {-->
<!--      margin: 0 10px;-->
<!--    }-->
<!--    nav a {-->
<!--      color: white;-->
<!--      text-decoration: none;-->
<!--    }-->
<!--    main {-->
<!--      padding: 20px;-->
<!--    }-->
<!--    #route-info-container {-->
<!--      margin-top: 20px;-->
<!--    }-->
<!--    .route-info {-->
<!--      background-color: #f1f1f1;-->
<!--      padding: 10px;-->
<!--      margin-bottom: 10px;-->
<!--    }-->
<!--    .saved-route-info {-->
<!--      background-color: #e5f2ed;-->
<!--      padding: 10px;-->
<!--      margin-bottom: 10px;-->
<!--    }-->
<!--  </style>-->
<!--</head>-->
<!--<body>-->
<!--  <header>-->
<!--    <nav>-->
<!--      <ul>-->
<!--        <li><a href="/">–ì–ª–∞–≤–Ω–∞—è</a></li>-->
<!--      </ul>-->
<!--    </nav>-->
<!--  </header>-->

<!--  <main>-->
<!--    <h1>–ö–∞—Ä—Ç–∞ –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–π</h1>-->
<!--    <div id="map"></div>-->
<!--    <div id="route-info-container"></div>-->
<!--    <div id="saved-routes-container"></div>-->
<!--  </main>-->

<!--  <footer>-->
<!--    <p>&copy; 2024 –°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–µ–º. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.</p>-->
<!--  </footer>-->

<!--  <script src="https://unpkg.com/leaflet@1.8.0/dist/leaflet.js"></script>-->
<!--  <script src="https://unpkg.com/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.js"></script>-->
<!--  <script>-->
<!--    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Ä—Ç—ã-->
<!--    var map = L.map('map').setView([62.5, 34.5], 8);-->

<!--    // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–ª–æ—è OpenStreetMap-->
<!--    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {-->
<!--      attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'-->
<!--    }).addTo(map);-->

<!--    // –ì—Ä—É–ø–ø–∞ –¥–ª—è –º–∞—Ä–∫–µ—Ä–æ–≤-->
<!--    var markers = L.featureGroup().addTo(map);-->

<!--    // –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –æ–±—ä–µ–∫—Ç–∞ –º–∞—Ä—à—Ä—É—Ç–∞-->
<!--    var routingControl;-->

<!--    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –Ω–∞ –∫–∞—Ä—Ç–µ –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –º–∞—Ä–∫–µ—Ä–æ–≤-->
<!--    map.on('click', function(e) {-->
<!--      var marker = L.marker(e.latlng).addTo(markers);-->
<!--      marker.bindPopup('–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã: ' + e.latlng.lat.toFixed(5) + ', ' + e.latlng.lng.toFixed(5));-->

<!--      updateRoute();-->
<!--    });-->

<!--    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –º–∞—Ä—à—Ä—É—Ç–∞-->
<!--    function updateRoute() {-->
<!--      // –ü–æ–ª—É—á–µ–Ω–∏–µ –º–∞—Å—Å–∏–≤–∞ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –º–∞—Ä–∫–µ—Ä–æ–≤-->
<!--      var markerCoords = markers.getLayers().map(function(marker) {-->
<!--        return marker.getLatLng();-->
<!--      });-->

<!--      // –û—á–∏—Å—Ç–∫–∞ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –º–∞—Ä—à—Ä—É—Ç–∞-->
<!--      if (routingControl) {-->
<!--        map.removeControl(routingControl);-->
<!--      }-->

<!--      // –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –º–∞—Ä—à—Ä—É—Ç–∞ —Å –ø–æ–º–æ—â—å—é Leaflet Routing Machine-->
<!--      routingControl = L.Routing.control({-->
<!--        waypoints: markerCoords,-->
<!--        routeWhileDragging: true,-->
<!--        showAlternatives: true,-->
<!--        altLineOptions: {-->
<!--          styles: [-->
<!--            { color: 'blue', weight: 4 },-->
<!--            { color: 'green', weight: 4 },-->
<!--            { color: 'orange', weight: 4 }-->
<!--          ]-->
<!--        },-->
<!--        createMarker: function(i, wp, n) {-->
<!--          return L.marker(wp.latLng, {-->
<!--            draggable: true,-->
<!--            icon: L.divIcon({ className: 'leaflet-marker-icon' })-->
<!--          });-->
<!--        },-->
<!--        routeWhileDragging: true,-->
<!--        show: false,-->
<!--        collapsible: true,-->
<!--        autoRoute: true,-->

<!--        itineraryControl: {-->
<!--          showSubHeading: true,-->
<!--          show: true-->
<!--        }-->
<!--      }).addTo(map);-->
<!--      // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –º–∞—Ä–∫–µ—Ä–∞-->
<!--      markers.on('click', function (e) {-->
<!--          if (e.layer) {-->
<!--              markers.removeLayer(e.layer);-->
<!--              updateRoute();-->
<!--          }-->
<!--      });-->
<!--      routingControl.on('routesfound', function(e) {-->
<!--        var routes = e.routes;-->
<!--        var summary = routes[0].summary;-->
<!--        var distance = (summary.totalDistance / 1000).toFixed(2); // –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ –≤ –∫–∏–ª–æ–º–µ—Ç—Ä–∞—Ö-->
<!--        var condition = '–•–æ—Ä–æ—à–µ–µ'; // –°–æ—Å—Ç–æ—è–Ω–∏–µ –¥–æ—Ä–æ–≥–∏ (–º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏–∫—É –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è)-->

<!--        // –û—Ç–æ–±—Ä–∞–∑–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –º–∞—Ä—à—Ä—É—Ç–µ –ø–æ–¥ –∫–∞—Ä—Ç–æ–π-->
<!--        const routeInfoContainer = document.getElementById('route-info-container');-->
<!--        const routeInfo = document.createElement('div');-->
<!--        routeInfo.classList.add('route-info');-->
<!--        routeInfo.innerHTML = `-->
<!--          <h3>–ú–∞—Ä—à—Ä—É—Ç</h3>-->
<!--          <p>–†–∞—Å—Å—Ç–æ—è–Ω–∏–µ: ${distance} –∫–º</p>-->
<!--          <p>–°–æ—Å—Ç–æ—è–Ω–∏–µ –¥–æ—Ä–æ–≥–∏: ${condition}</p>-->
<!--          <button class="save-route-btn" data-distance="${distance}">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>-->
<!--        `;-->
<!--        routeInfoContainer.appendChild(routeInfo);-->

<!--        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –Ω–∞ –∫–Ω–æ–ø–∫—É "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å"-->
<!--        const saveRouteBtn = routeInfo.querySelector('.save-route-btn');-->
<!--        saveRouteBtn.addEventListener('click', function() {-->
<!--          const selectedDistance = this.dataset.distance;-->
<!--          saveRoute(selectedDistance);-->
<!--        });-->
<!--      });-->
<!--    }-->

<!--    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –º–∞—Ä—à—Ä—É—Ç–∞-->
<!--    function saveRoute(distance) {-->
<!--      // –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –º–∞—Ä—à—Ä—É—Ç–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä-->
<!--      fetch('/save_route', {-->
<!--        method: 'POST',-->
<!--        headers: {-->
<!--          'Content-Type': 'application/json'-->
<!--        },-->
<!--        body: JSON.stringify({ distance: distance })-->
<!--      })-->
<!--      .then(response => response.json())-->
<!--      .then(data => {-->
<!--        console.log('Saved route:', data);-->

<!--        // –û—Ç–æ–±—Ä–∞–∑–∏—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ-->
<!--        const savedRouteContainer = document.getElementById('saved-routes-container');-->
<!--        const savedRouteInfo = document.createElement('div');-->
<!--        savedRouteInfo.classList.add('saved-route-info');-->
<!--        savedRouteInfo.innerHTML = `-->
<!--          <h3>–°–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–π –º–∞—Ä—à—Ä—É—Ç</h3>-->
<!--          <p>–†–∞—Å—Å—Ç–æ—è–Ω–∏–µ: ${data.distance} –∫–º</p>-->
<!--          <p>–í—Ä–µ–º—è –≤ –ø—É—Ç–∏: ${data.travel_time}</p>-->
<!--          <p>–í–º–µ—Å—Ç–∏–º–æ—Å—Ç—å: ${data.capacity} —Ç–æ–Ω–Ω</p>-->
<!--        `;-->
<!--        savedRouteContainer.appendChild(savedRouteInfo);-->
<!--      })-->
<!--      .catch(error => {-->
<!--        console.error('Error saving route:', error);-->
<!--      });-->
<!--    }-->
<!--  </script>-->
<!--</body>-->
<!--</html>-->


